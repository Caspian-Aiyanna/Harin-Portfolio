```{r}
#| echo: false
#| message: false
library(readr)
library(htmltools)

projects <- readr::read_csv("data/projects.csv", show_col_types = FALSE)

render_card <- function(title, role, year, summary, link = NULL, tag_text = NULL){
  # Build badges if tag_text is present (semicolon-separated)
  badge_block <- NULL
  if (!is.null(tag_text) && !is.na(tag_text) && nzchar(tag_text)) {
    parts <- strsplit(tag_text, ";")[[1]]
    badge_block <- htmltools::tags$span(
      lapply(parts, function(t) htmltools::tags$span(class="badge bg-secondary me-1", t))
    )
  }

  as.character(
    htmltools::div(class="card mb-3 p-3",
      htmltools::tags$h4(title),
      htmltools::tags$p(htmltools::tags$strong(role), " â€¢ ", year),
      htmltools::tags$p(summary),
      if (!is.null(link) && !is.na(link) && nzchar(link)) {
        htmltools::tags$a(href = link, target = "_blank", "View")
      },
      badge_block
    )
  )
}

html <- paste0(apply(projects, 1, function(r){
  render_card(
    title   = r[['title']],
    role    = r[['role']],
    year    = r[['year']],
    summary = r[['summary']],
    link    = r[['link']],
    tag_text= r[['tags']]
  )
}), collapse = "\n")

HTML(html)
